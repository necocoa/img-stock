<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1029px" preserveAspectRatio="none" style="width:1008px;height:1029px;background:#FFFFFE;" version="1.1" viewBox="0 0 1008 1029" width="1008px" zoomAndPan="magnify"><defs><filter height="300%" id="f1v8xek6j3z9bi" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="Menlo" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="126" x="441.5" y="26.708">メッセージ表示</text><rect fill="#FFFFFF" filter="url(#f1v8xek6j3z9bi)" height="802.1563" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="34" y="131.25"/><rect fill="#FFFFFF" filter="url(#f1v8xek6j3z9bi)" height="312.0313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="198" y="612.375"/><rect fill="#FFFFFF" filter="url(#f1v8xek6j3z9bi)" height="434.8594" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="398" y="167.5156"/><rect fill="#FFFFFF" filter="url(#f1v8xek6j3z9bi)" height="122.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="403" y="386.4453"/><rect fill="#FFFFFF" filter="url(#f1v8xek6j3z9bi)" height="59.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="619" y="196.6484"/><rect fill="#FFFFFF" filter="url(#f1v8xek6j3z9bi)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="619" y="285.0469"/><rect fill="#FFFFFF" filter="url(#f1v8xek6j3z9bi)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="719" y="343.3125"/><rect fill="#FFFFFF" filter="url(#f1v8xek6j3z9bi)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="819" y="386.4453"/><rect fill="#FFFFFF" filter="url(#f1v8xek6j3z9bi)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="931" y="444.7109"/><rect fill="#FFFFFE" filter="url(#f1v8xek6j3z9bi)" height="262.7344" style="stroke: #000000; stroke-width: 2.0;" width="308" x="115" y="633.5391"/><rect fill="#FFFFFE" filter="url(#f1v8xek6j3z9bi)" height="147.3359" style="stroke: #000000; stroke-width: 2.0;" width="288" x="125" y="741.9375"/><rect fill="#FFFFFE" filter="url(#f1v8xek6j3z9bi)" height="116.2031" style="stroke: #000000; stroke-width: 2.0;" width="268" x="135" y="766.0703"/><rect fill="#FFFFFE" height="56.9375" style="stroke: none; stroke-width: 1.0;" width="268" x="135" y="825.3359"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="39" x2="39" y1="121.25" y2="942.4063"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="203" x2="203" y1="613.8906" y2="942.4063"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="403" x2="403" y1="121.25" y2="942.4063"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="624" x2="624" y1="121.25" y2="942.4063"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="724" x2="724" y1="121.25" y2="942.4063"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="824" x2="824" y1="121.25" y2="942.4063"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="936" x2="936" y1="121.25" y2="942.4063"/><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="8" y="117.9482">ユーザー</text><ellipse cx="39" cy="47.9531" fill="#FEFECE" filter="url(#f1v8xek6j3z9bi)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M39,55.9531 L39,82.9531 M26,63.9531 L52,63.9531 M39,82.9531 L26,97.9531 M39,82.9531 L52,97.9531 " fill="none" filter="url(#f1v8xek6j3z9bi)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="8" y="954.4014">ユーザー</text><ellipse cx="39" cy="967.7031" fill="#FEFECE" filter="url(#f1v8xek6j3z9bi)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M39,975.7031 L39,1002.7031 M26,983.7031 L52,983.7031 M39,1002.7031 L26,1017.7031 M39,1002.7031 L52,1017.7031 " fill="none" filter="url(#f1v8xek6j3z9bi)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#99FF99" filter="url(#f1v8xek6j3z9bi)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="145" y="941.4063"/><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="152" y="961.4014">メッセージ画面</text><rect fill="#FEFECE" filter="url(#f1v8xek6j3z9bi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="110" x="346" y="69.6563"/><text fill="#000000" font-family="Menlo" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="96" x="353" y="89.6514">«Controller»</text><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="64" x="369" y="105.9482">Messages</text><rect fill="#FEFECE" filter="url(#f1v8xek6j3z9bi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="110" x="346" y="941.4063"/><text fill="#000000" font-family="Menlo" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="96" x="353" y="961.4014">«Controller»</text><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="64" x="369" y="977.6982">Messages</text><rect fill="#FEFECE" filter="url(#f1v8xek6j3z9bi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="587" y="69.6563"/><text fill="#000000" font-family="Menlo" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="56" x="594" y="89.6514">«Model»</text><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="606" y="105.9482">User</text><rect fill="#FEFECE" filter="url(#f1v8xek6j3z9bi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="587" y="941.4063"/><text fill="#000000" font-family="Menlo" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="56" x="594" y="961.4014">«Model»</text><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="606" y="977.6982">User</text><rect fill="#FEFECE" filter="url(#f1v8xek6j3z9bi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="671" y="69.6563"/><text fill="#000000" font-family="Menlo" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="56" x="694" y="89.6514">«Model»</text><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="678" y="105.9482">UserMessage</text><rect fill="#FEFECE" filter="url(#f1v8xek6j3z9bi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="671" y="941.4063"/><text fill="#000000" font-family="Menlo" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="56" x="694" y="961.4014">«Model»</text><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="678" y="977.6982">UserMessage</text><rect fill="#FEFECE" filter="url(#f1v8xek6j3z9bi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="787" y="69.6563"/><text fill="#000000" font-family="Menlo" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="56" x="794" y="89.6514">«Model»</text><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="794" y="105.9482">Message</text><rect fill="#FEFECE" filter="url(#f1v8xek6j3z9bi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="787" y="941.4063"/><text fill="#000000" font-family="Menlo" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="56" x="794" y="961.4014">«Model»</text><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="794" y="977.6982">Message</text><rect fill="#FEFECE" filter="url(#f1v8xek6j3z9bi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="871" y="69.6563"/><text fill="#000000" font-family="Menlo" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="56" x="906" y="89.6514">«Model»</text><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="878" y="105.9482">MessageContent</text><rect fill="#FEFECE" filter="url(#f1v8xek6j3z9bi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="871" y="941.4063"/><text fill="#000000" font-family="Menlo" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="56" x="906" y="961.4014">«Model»</text><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="878" y="977.6982">MessageContent</text><rect fill="#FFFFFF" filter="url(#f1v8xek6j3z9bi)" height="802.1563" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="34" y="131.25"/><rect fill="#FFFFFF" filter="url(#f1v8xek6j3z9bi)" height="312.0313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="198" y="612.375"/><rect fill="#FFFFFF" filter="url(#f1v8xek6j3z9bi)" height="434.8594" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="398" y="167.5156"/><rect fill="#FFFFFF" filter="url(#f1v8xek6j3z9bi)" height="122.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="403" y="386.4453"/><rect fill="#FFFFFF" filter="url(#f1v8xek6j3z9bi)" height="59.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="619" y="196.6484"/><rect fill="#FFFFFF" filter="url(#f1v8xek6j3z9bi)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="619" y="285.0469"/><rect fill="#FFFFFF" filter="url(#f1v8xek6j3z9bi)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="719" y="343.3125"/><rect fill="#FFFFFF" filter="url(#f1v8xek6j3z9bi)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="819" y="386.4453"/><rect fill="#FFFFFF" filter="url(#f1v8xek6j3z9bi)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="931" y="444.7109"/><polygon fill="#A80036" points="386,163.5156,396,167.5156,386,171.5156,390,167.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="44" x2="392" y1="167.5156" y2="167.5156"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="51" y="147.3169">メッセージを開く</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="51" y="162.4497">:index()</text><polygon fill="#A80036" points="607,192.6484,617,196.6484,607,200.6484,611,196.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="408" x2="613" y1="196.6484" y2="196.6484"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="415" y="191.5825">ログイン状態か？</text><rect fill="#FFFFFF" filter="url(#f1v8xek6j3z9bi)" height="40.2656" style="stroke: #000000; stroke-width: 2.0;" width="120" x="584" y="204.6484"/><polygon fill="#EEEEEE" points="584,204.6484,653,204.6484,653,211.6484,643,221.6484,584,221.6484,584,204.6484" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="Menlo" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="24" x="597" y="218.7153">ref</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="590" y="237.7153">ログインチェック!</text><polygon fill="#A80036" points="419,251.9141,409,255.9141,419,259.9141,415,255.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="413" x2="623" y1="255.9141" y2="255.9141"/><polygon fill="#A80036" points="607,281.0469,617,285.0469,607,289.0469,611,285.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="408" x2="613" y1="285.0469" y2="285.0469"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="415" y="279.981">current_userを取得</text><polygon fill="#A80036" points="419,295.0469,409,299.0469,419,303.0469,415,299.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="413" x2="623" y1="299.0469" y2="299.0469"/><polygon fill="#A80036" points="707,339.3125,717,343.3125,707,347.3125,711,343.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="408" x2="713" y1="343.3125" y2="343.3125"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="415" y="323.1138">current_user_idに一致する</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="415" y="338.2466">message_idとreceived_atを取得</text><polygon fill="#A80036" points="419,353.3125,409,357.3125,419,361.3125,415,357.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="413" x2="723" y1="357.3125" y2="357.3125"/><polygon fill="#A80036" points="807,382.4453,817,386.4453,807,390.4453,811,386.4453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="413" x2="813" y1="386.4453" y2="386.4453"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="420" y="381.3794">message_idsがidと一致するmessageを取得</text><polygon fill="#A80036" points="424,396.4453,414,400.4453,424,404.4453,420,400.4453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="418" x2="823" y1="400.4453" y2="400.4453"/><polygon fill="#A80036" points="919,440.7109,929,444.7109,919,448.7109,923,444.7109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="413" x2="925" y1="444.7109" y2="444.7109"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="420" y="424.5122">messageに関連するmessage_contentsを</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="420" y="439.645">preloadで取得</text><polygon fill="#A80036" points="424,454.7109,414,458.7109,424,462.7109,420,458.7109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="418" x2="935" y1="458.7109" y2="458.7109"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="413" x2="455" y1="507.9766" y2="507.9766"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="455" x2="455" y1="507.9766" y2="520.9766"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="408" x2="455" y1="520.9766" y2="520.9766"/><polygon fill="#A80036" points="418,516.9766,408,520.9766,418,524.9766,414,520.9766" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="420" y="487.7778">messagesを</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="420" y="502.9106">received_atが古い順で並べる</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="408" x2="450" y1="560.2422" y2="560.2422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="450" x2="450" y1="560.2422" y2="573.2422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="409" x2="450" y1="573.2422" y2="573.2422"/><polygon fill="#A80036" points="419,569.2422,409,573.2422,419,577.2422,415,573.2422" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="415" y="540.0435">message_contentsを</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="415" y="555.1763">created_atが古い順で並べる</text><polygon fill="#A80036" points="272,598.375,262,602.375,272,606.375,268,602.375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="266" x2="402" y1="602.375" y2="602.375"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="278" y="597.3091">messagesを渡す</text><rect fill="#99FF99" filter="url(#f1v8xek6j3z9bi)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="145" y="581.2422"/><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="152" y="601.2373">メッセージ画面</text><path d="M115,633.5391 L192,633.5391 L192,640.5391 L182,650.5391 L115,650.5391 L115,633.5391 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="262.7344" style="stroke: #000000; stroke-width: 2.0;" width="308" x="115" y="633.5391"/><text fill="#000000" font-family="Menlo" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="130" y="646.606">loop</text><text fill="#000000" font-family="Menlo" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="207" y="645.7495">[messages分]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="208" x2="250" y1="671.8047" y2="671.8047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="250" x2="250" y1="671.8047" y2="684.8047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="209" x2="250" y1="684.8047" y2="684.8047"/><polygon fill="#A80036" points="219,680.8047,209,684.8047,219,688.8047,215,684.8047" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="215" y="666.7388">iconを表示する</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="208" x2="250" y1="713.9375" y2="713.9375"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="250" x2="250" y1="713.9375" y2="726.9375"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="209" x2="250" y1="726.9375" y2="726.9375"/><polygon fill="#A80036" points="219,722.9375,209,726.9375,219,730.9375,215,726.9375" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="215" y="708.8716">received_atを表示する</text><path d="M125,741.9375 L202,741.9375 L202,748.9375 L192,758.9375 L125,758.9375 L125,741.9375 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="147.3359" style="stroke: #000000; stroke-width: 2.0;" width="288" x="125" y="741.9375"/><text fill="#000000" font-family="Menlo" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="140" y="755.0044">loop</text><text fill="#000000" font-family="Menlo" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="217" y="754.1479">[contests分]</text><path d="M135,766.0703 L204,766.0703 L204,773.0703 L194,783.0703 L135,783.0703 L135,766.0703 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="116.2031" style="stroke: #000000; stroke-width: 2.0;" width="268" x="135" y="766.0703"/><text fill="#000000" font-family="Menlo" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="24" x="150" y="779.1372">alt</text><text fill="#000000" font-family="Menlo" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="219" y="778.2808">[タイプがテキスト]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="208" x2="250" y1="804.3359" y2="804.3359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="250" x2="250" y1="804.3359" y2="817.3359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="209" x2="250" y1="817.3359" y2="817.3359"/><polygon fill="#A80036" points="219,813.3359,209,817.3359,219,821.3359,215,817.3359" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="215" y="799.27">contentをテキストUIで表示</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="135" x2="403" y1="826.3359" y2="826.3359"/><text fill="#000000" font-family="Menlo" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="140" y="836.5464">[タイプがイメージ]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="208" x2="250" y1="861.2734" y2="861.2734"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="250" x2="250" y1="861.2734" y2="874.2734"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="209" x2="250" y1="874.2734" y2="874.2734"/><polygon fill="#A80036" points="219,870.2734,209,874.2734,219,878.2734,215,874.2734" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="215" y="856.2075">thumbnailを画像UIで表示</text><polygon fill="#A80036" points="55,920.4063,45,924.4063,55,928.4063,51,924.4063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="49" x2="202" y1="924.4063" y2="924.4063"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="61" y="919.3403">メッセージ画面を表示</text><!--MD5=[821a78a58a1ce8935d59162ea4e428ac]
@startuml
skinparam defaultFontName Menlo
skinparam backgroundColor #FFFFFE

title メッセージ表示

actor ユーザー as user
participant メッセージ画面 as messages_index #99FF99
participant Messages as Messages <<Controller>>
participant User as User <<Model>>
participant UserMessage as UserMessage <<Model>>
participant Message as Message <<Model>>
participant MessageContent as MessageContent <<Model>>

activate user
user -> Messages: メッセージを開く\n:index()
activate Messages

Messages -> User: ログイン状態か？
activate User
ref over User: ログインチェック!
User - -> Messages
deactivate User

Messages -> User: current_userを取得
activate User
User - -> Messages
deactivate User

Messages -> UserMessage: current_user_idに一致する\nmessage_idとreceived_atを取得
activate UserMessage
UserMessage - -> Messages
deactivate UserMessage

Messages -> Message: message_idsがidと一致するmessageを取得
activate Messages
activate Message
Message - -> Messages
deactivate Message

Messages -> MessageContent: messageに関連するmessage_contentsを\npreloadで取得
activate MessageContent
MessageContent - -> Messages
deactivate MessageContent

Messages -> Messages: messagesを\nreceived_atが古い順で並べる
deactivate Messages
Messages -> Messages: message_contentsを\ncreated_atが古い順で並べる

create messages_index
Messages - -> messages_index: messagesを渡す
activate messages_index
deactivate Messages

loop messages分
  messages_index -> messages_index: iconを表示する
  messages_index -> messages_index: received_atを表示する
  loop contests分
    alt タイプがテキスト
      messages_index -> messages_index: contentをテキストUIで表示
    else タイプがイメージ
      messages_index -> messages_index: thumbnailを画像UIで表示
    end
  end
end
messages_index - -> user: メッセージ画面を表示
deactivate messages_index
@enduml

PlantUML version 1.2020.12(Sat Jun 06 19:54:15 JST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: ja
Country: JP
--></g></svg>