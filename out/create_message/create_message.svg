<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2221px" preserveAspectRatio="none" style="width:1367px;height:2221px;background:#FFFFFE;" version="1.1" viewBox="0 0 1367 2221" width="1367px" zoomAndPan="magnify"><defs><filter height="300%" id="fr20d1kb3qdxo" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="Menlo" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="180" x="589" y="26.708">メッセージを作成する</text><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="1914.2578" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="52" y="210.6484"/><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="50.4297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="307" y="323.0469"/><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="1663.1641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="307" y="445.7422"/><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="102.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="485" y="210.6484"/><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="1246.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="485" y="712.7422"/><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="347.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="678" y="953.8047"/><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="450.6016" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="901" y="1383.6016"/><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="59.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1139" y="239.7813"/><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="59.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1139" y="741.875"/><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="35.2969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1258" y="2029.6719"/><rect fill="#FFFFFE" filter="url(#fr20d1kb3qdxo)" height="150.4688" style="stroke: #000000; stroke-width: 2.0;" width="391" x="13" y="489.875"/><rect fill="#FFFFFE" filter="url(#fr20d1kb3qdxo)" height="90.2031" style="stroke: #000000; stroke-width: 2.0;" width="371" x="23" y="543.1406"/><rect fill="#FFFFFE" height="43.9375" style="stroke: none; stroke-width: 1.0;" width="371" x="23" y="589.4063"/><rect fill="#FFFFFE" filter="url(#fr20d1kb3qdxo)" height="1004.9297" style="stroke: #000000; stroke-width: 2.0;" width="764" x="399" y="858.2734"/><rect fill="#FFFFFE" filter="url(#fr20d1kb3qdxo)" height="103.2031" style="stroke: #000000; stroke-width: 2.0;" width="352" x="419" y="1213"/><rect fill="#FFFFFE" height="56.9375" style="stroke: none; stroke-width: 1.0;" width="352" x="419" y="1259.2656"/><rect fill="#FFFFFE" filter="url(#fr20d1kb3qdxo)" height="526" style="stroke: #000000; stroke-width: 2.0;" width="744" x="409" y="1330.2031"/><rect fill="#FFFFFE" filter="url(#fr20d1kb3qdxo)" height="146.4688" style="stroke: #000000; stroke-width: 2.0;" width="312" x="831" y="1600.6641"/><rect fill="#FFFFFE" height="72.0703" style="stroke: none; stroke-width: 1.0;" width="312" x="831" y="1675.0625"/><rect fill="#FFFFFE" filter="url(#fr20d1kb3qdxo)" height="88.0703" style="stroke: #000000; stroke-width: 2.0;" width="575" x="419" y="1761.1328"/><rect fill="#FFFFFE" height="56.9375" style="stroke: none; stroke-width: 1.0;" width="575" x="419" y="1792.2656"/><rect fill="#FFFFFE" filter="url(#fr20d1kb3qdxo)" height="90.2031" style="stroke: #000000; stroke-width: 2.0;" width="331" x="230" y="1877.2031"/><rect fill="#FFFFFE" height="43.9375" style="stroke: none; stroke-width: 1.0;" width="331" x="230" y="1923.4688"/><rect fill="#FFFFFE" filter="url(#fr20d1kb3qdxo)" height="135.5" style="stroke: #000000; stroke-width: 2.0;" width="1322" x="23" y="1981.4063"/><rect fill="#FFFFFE" height="43.9375" style="stroke: none; stroke-width: 1.0;" width="1322" x="23" y="2072.9688"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="57" x2="57" y1="121.25" y2="2133.9063"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="312" x2="312" y1="339.6953" y2="2133.9063"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="490" x2="490" y1="121.25" y2="2133.9063"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="683" x2="683" y1="121.25" y2="2133.9063"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="906" x2="906" y1="121.25" y2="2133.9063"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1144" x2="1144" y1="121.25" y2="2133.9063"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1263" x2="1263" y1="2031.1875" y2="2133.9063"/><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="33" y="117.9482">管理者</text><ellipse cx="57" cy="47.9531" fill="#FEFECE" filter="url(#fr20d1kb3qdxo)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M57,55.9531 L57,82.9531 M44,63.9531 L70,63.9531 M57,82.9531 L44,97.9531 M57,82.9531 L70,97.9531 " fill="none" filter="url(#fr20d1kb3qdxo)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="33" y="2145.9014">管理者</text><ellipse cx="57" cy="2159.2031" fill="#FEFECE" filter="url(#fr20d1kb3qdxo)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M57,2167.2031 L57,2194.2031 M44,2175.2031 L70,2175.2031 M57,2194.2031 L44,2209.2031 M57,2194.2031 L70,2209.2031 " fill="none" filter="url(#fr20d1kb3qdxo)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#99FF99" filter="url(#fr20d1kb3qdxo)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="140" x="240" y="2132.9063"/><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="126" x="247" y="2152.9014">メッセージ作成画面</text><rect fill="#FEFECE" filter="url(#fr20d1kb3qdxo)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="429" y="69.6563"/><text fill="#000000" font-family="Menlo" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="96" x="440" y="89.6514">«Controller»</text><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="436" y="105.9482">AdminMessages</text><rect fill="#FEFECE" filter="url(#fr20d1kb3qdxo)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="429" y="2132.9063"/><text fill="#000000" font-family="Menlo" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="96" x="440" y="2152.9014">«Controller»</text><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="436" y="2169.1982">AdminMessages</text><rect fill="#FEFECE" filter="url(#fr20d1kb3qdxo)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="646" y="69.6563"/><text fill="#000000" font-family="Menlo" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="56" x="653" y="89.6514">«Model»</text><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="653" y="105.9482">Message</text><rect fill="#FEFECE" filter="url(#fr20d1kb3qdxo)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="646" y="2132.9063"/><text fill="#000000" font-family="Menlo" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="56" x="653" y="2152.9014">«Model»</text><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="653" y="2169.1982">Message</text><rect fill="#FEFECE" filter="url(#fr20d1kb3qdxo)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="841" y="69.6563"/><text fill="#000000" font-family="Menlo" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="56" x="876" y="89.6514">«Model»</text><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="848" y="105.9482">MessageContent</text><rect fill="#FEFECE" filter="url(#fr20d1kb3qdxo)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="841" y="2132.9063"/><text fill="#000000" font-family="Menlo" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="56" x="876" y="2152.9014">«Model»</text><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="848" y="2169.1982">MessageContent</text><rect fill="#FEFECE" filter="url(#fr20d1kb3qdxo)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="1107" y="69.6563"/><text fill="#000000" font-family="Menlo" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="56" x="1114" y="89.6514">«Model»</text><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="1126" y="105.9482">User</text><rect fill="#FEFECE" filter="url(#fr20d1kb3qdxo)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="1107" y="2132.9063"/><text fill="#000000" font-family="Menlo" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="56" x="1114" y="2152.9014">«Model»</text><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="1126" y="2169.1982">User</text><rect fill="#99FF99" filter="url(#fr20d1kb3qdxo)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="140" x="1191" y="2132.9063"/><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="126" x="1198" y="2152.9014">メッセージ一覧画面</text><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="1914.2578" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="52" y="210.6484"/><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="50.4297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="307" y="323.0469"/><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="1663.1641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="307" y="445.7422"/><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="102.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="485" y="210.6484"/><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="1246.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="485" y="712.7422"/><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="347.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="678" y="953.8047"/><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="450.6016" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="901" y="1383.6016"/><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="59.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1139" y="239.7813"/><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="59.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1139" y="741.875"/><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="35.2969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1258" y="2029.6719"/><rect fill="#EEEEEE" filter="url(#fr20d1kb3qdxo)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1352" x="3" y="151.8164"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1355" y1="151.8164" y2="151.8164"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1355" y1="154.8164" y2="154.8164"/><rect fill="#EEEEEE" filter="url(#fr20d1kb3qdxo)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="113" x="622.5" y="141.25"/><text fill="#000000" font-family="Menlo" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="628.5" y="157.3169">作成画面を表示</text><polygon fill="#A80036" points="473,206.6484,483,210.6484,473,214.6484,477,210.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="62" x2="479" y1="210.6484" y2="210.6484"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="69" y="190.4497">メッセージ作成画面を開く</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="69" y="205.5825">:new()</text><polygon fill="#A80036" points="1127,235.7813,1137,239.7813,1127,243.7813,1131,239.7813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="495" x2="1133" y1="239.7813" y2="239.7813"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="502" y="234.7153">管理者か？</text><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="40.2656" style="stroke: #000000; stroke-width: 2.0;" width="107" x="1104" y="247.7813"/><polygon fill="#EEEEEE" points="1104,247.7813,1173,247.7813,1173,254.7813,1163,264.7813,1104,264.7813,1104,247.7813" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="Menlo" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="24" x="1117" y="261.8481">ref</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="1110" y="280.8481">管理者チェック!</text><polygon fill="#A80036" points="506,295.0469,496,299.0469,506,303.0469,502,299.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="500" x2="1143" y1="299.0469" y2="299.0469"/><polygon fill="#A80036" points="395,309.0469,385,313.0469,395,317.0469,391,313.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="389" x2="489" y1="313.0469" y2="313.0469"/><rect fill="#99FF99" filter="url(#fr20d1kb3qdxo)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="140" x="240" y="307.0469"/><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="126" x="247" y="327.042">メッセージ作成画面</text><polygon fill="#A80036" points="73,369.4766,63,373.4766,73,377.4766,69,373.4766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="67" x2="311" y1="373.4766" y2="373.4766"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="79" y="368.4106">メッセージ作成画面を表示</text><rect fill="#EEEEEE" filter="url(#fr20d1kb3qdxo)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1352" x="3" y="402.043"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1355" y1="402.043" y2="402.043"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1355" y1="405.043" y2="405.043"/><rect fill="#EEEEEE" filter="url(#fr20d1kb3qdxo)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="126" x="616" y="391.4766"/><text fill="#000000" font-family="Menlo" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="104" x="622" y="407.5435">メッセージを作成</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="295" y1="445.7422" y2="441.7422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="295" y1="445.7422" y2="449.7422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="62" x2="306" y1="445.7422" y2="445.7422"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="69" y="440.6763">タイトルを入力する</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="295" y1="474.875" y2="470.875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="295" y1="474.875" y2="478.875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="62" x2="306" y1="474.875" y2="474.875"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="69" y="469.8091">配信する日付と時間を入力する</text><path d="M13,489.875 L90,489.875 L90,496.875 L80,506.875 L13,506.875 L13,489.875 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="150.4688" style="stroke: #000000; stroke-width: 2.0;" width="391" x="13" y="489.875"/><text fill="#000000" font-family="Menlo" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="28" y="502.9419">loop</text><text fill="#000000" font-family="Menlo" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="105" y="502.0854">[メッセージコンテンツの個数]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="295" y1="528.1406" y2="524.1406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="295" y1="528.1406" y2="532.1406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="62" x2="306" y1="528.1406" y2="528.1406"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="69" y="523.0747">コンテンツのタイプを選択する</text><path d="M23,543.1406 L92,543.1406 L92,550.1406 L82,560.1406 L23,560.1406 L23,543.1406 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.2031" style="stroke: #000000; stroke-width: 2.0;" width="371" x="23" y="543.1406"/><text fill="#000000" font-family="Menlo" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="24" x="38" y="556.2075">alt</text><text fill="#000000" font-family="Menlo" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="107" y="555.3511">[タイプがテキスト]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="295" y1="581.4063" y2="577.4063"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="295" y1="581.4063" y2="585.4063"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="62" x2="306" y1="581.4063" y2="581.4063"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="69" y="576.3403">テキストを入力する</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="394" y1="590.4063" y2="590.4063"/><text fill="#000000" font-family="Menlo" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="28" y="600.6167">[タイプがイメージ]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="295" y1="625.3438" y2="621.3438"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="295" y1="625.3438" y2="629.3438"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="62" x2="306" y1="625.3438" y2="625.3438"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="69" y="620.2778">画像URLを入力する</text><polygon fill="#A80036" points="295,664.4766,305,668.4766,295,672.4766,299,668.4766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="62" x2="301" y1="668.4766" y2="668.4766"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="69" y="663.4106">メッセージ作成ボタンを押す</text><polygon fill="#A80036" points="473,708.7422,483,712.7422,473,716.7422,477,712.7422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="317" x2="479" y1="712.7422" y2="712.7422"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="324" y="692.5435">フォーム内容をPOSTする</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="324" y="707.6763">:create()</text><polygon fill="#A80036" points="1127,737.875,1137,741.875,1127,745.875,1131,741.875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="495" x2="1133" y1="741.875" y2="741.875"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="502" y="736.8091">管理者か？</text><rect fill="#FFFFFF" filter="url(#fr20d1kb3qdxo)" height="40.2656" style="stroke: #000000; stroke-width: 2.0;" width="107" x="1104" y="749.875"/><polygon fill="#EEEEEE" points="1104,749.875,1173,749.875,1173,756.875,1163,766.875,1104,766.875,1104,749.875" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="Menlo" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="24" x="1117" y="763.9419">ref</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="1110" y="782.9419">管理者チェック!</text><polygon fill="#A80036" points="506,797.1406,496,801.1406,506,805.1406,502,801.1406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="500" x2="1143" y1="801.1406" y2="801.1406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="495" x2="537" y1="830.2734" y2="830.2734"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="537" y1="830.2734" y2="843.2734"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="496" x2="537" y1="843.2734" y2="843.2734"/><polygon fill="#A80036" points="506,839.2734,496,843.2734,506,847.2734,502,843.2734" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="502" y="825.2075">ストロングパラメータを通す</text><path d="M399,858.2734 L532,858.2734 L532,865.2734 L522,875.2734 L399,875.2734 L399,858.2734 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1004.9297" style="stroke: #000000; stroke-width: 2.0;" width="764" x="399" y="858.2734"/><text fill="#000000" font-family="Menlo" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="88" x="414" y="871.3403">Transaction</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="495" x2="537" y1="896.5391" y2="896.5391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="537" y1="896.5391" y2="909.5391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="496" x2="537" y1="909.5391" y2="909.5391"/><polygon fill="#A80036" points="506,905.5391,496,909.5391,506,913.5391,502,909.5391" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="502" y="891.4731">トランザクション コミット</text><polygon fill="#A80036" points="666,949.8047,676,953.8047,666,957.8047,670,953.8047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="495" x2="672" y1="953.8047" y2="953.8047"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="502" y="933.606">メッセージを作成</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="502" y="948.7388">:new()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="688" x2="730" y1="1028.3359" y2="1028.3359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="730" x2="730" y1="1028.3359" y2="1041.3359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="689" x2="730" y1="1041.3359" y2="1041.3359"/><polygon fill="#A80036" points="699,1037.3359,689,1041.3359,699,1045.3359,695,1041.3359" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="695" y="977.8716">パラメータの</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="695" y="993.0044">タイトル</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="695" y="1008.1372">配信日</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="695" y="1023.27">をセット</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="688" x2="730" y1="1070.4688" y2="1070.4688"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="730" x2="730" y1="1070.4688" y2="1083.4688"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="689" x2="730" y1="1083.4688" y2="1083.4688"/><polygon fill="#A80036" points="699,1079.4688,689,1083.4688,699,1087.4688,695,1083.4688" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="695" y="1065.4028">ステータスを未配信でセット</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="688" x2="730" y1="1112.6016" y2="1112.6016"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="730" x2="730" y1="1112.6016" y2="1125.6016"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="689" x2="730" y1="1125.6016" y2="1125.6016"/><polygon fill="#A80036" points="699,1121.6016,689,1125.6016,699,1129.6016,695,1125.6016" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="695" y="1107.5356">メッセージをセーブ</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="688" x2="730" y1="1185" y2="1185"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="730" x2="730" y1="1185" y2="1198"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="689" x2="730" y1="1198" y2="1198"/><polygon fill="#A80036" points="699,1194,689,1198,699,1202,695,1198" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="695" y="1149.6685">validates</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="695" y="1164.8013">タイトルが存在するか？</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="695" y="1179.9341">配信時間がdate型でnow以降か？</text><path d="M419,1213 L488,1213 L488,1220 L478,1230 L419,1230 L419,1213 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="103.2031" style="stroke: #000000; stroke-width: 2.0;" width="352" x="419" y="1213"/><text fill="#000000" font-family="Menlo" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="24" x="434" y="1226.0669">alt</text><text fill="#000000" font-family="Menlo" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58" x="503" y="1225.2104">[作成成功]</text><polygon fill="#A80036" points="506,1247.2656,496,1251.2656,506,1255.2656,502,1251.2656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="500" x2="677" y1="1251.2656" y2="1251.2656"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="512" y="1246.1997">メッセージを返す</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="419" x2="771" y1="1260.2656" y2="1260.2656"/><text fill="#000000" font-family="Menlo" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58" x="424" y="1270.4761">[作成失敗]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="688" x2="730" y1="1300.2031" y2="1300.2031"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="730" x2="730" y1="1300.2031" y2="1313.2031"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="683" x2="730" y1="1313.2031" y2="1313.2031"/><polygon fill="#A80036" points="693,1309.2031,683,1313.2031,693,1317.2031,689,1313.2031" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="695" y="1295.1372">rollback</text><path d="M409,1330.2031 L486,1330.2031 L486,1337.2031 L476,1347.2031 L409,1347.2031 L409,1330.2031 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="526" style="stroke: #000000; stroke-width: 2.0;" width="744" x="409" y="1330.2031"/><text fill="#000000" font-family="Menlo" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="424" y="1343.27">loop</text><text fill="#000000" font-family="Menlo" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="501" y="1342.4136">[コンテンツの個数]</text><polygon fill="#A80036" points="889,1379.6016,899,1383.6016,889,1387.6016,893,1383.6016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="495" x2="895" y1="1383.6016" y2="1383.6016"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="502" y="1363.4028">メッセージコンテンツを作成</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="502" y="1378.5356">:message.message_contents.new</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="911" x2="953" y1="1458.1328" y2="1458.1328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="953" x2="953" y1="1458.1328" y2="1471.1328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="912" x2="953" y1="1471.1328" y2="1471.1328"/><polygon fill="#A80036" points="922,1467.1328,912,1471.1328,922,1475.1328,918,1471.1328" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="918" y="1407.6685">パラメータの</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="918" y="1422.8013">コンテンツタイプ</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="918" y="1437.9341">コンテンツ(テキストorサムネイル)</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="918" y="1453.0669">をセット</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="911" x2="953" y1="1500.2656" y2="1500.2656"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="953" x2="953" y1="1500.2656" y2="1513.2656"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="912" x2="953" y1="1513.2656" y2="1513.2656"/><polygon fill="#A80036" points="922,1509.2656,912,1513.2656,922,1517.2656,918,1513.2656" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="918" y="1495.1997">メッセージコンテンツをセーブ</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="911" x2="953" y1="1572.6641" y2="1572.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="953" x2="953" y1="1572.6641" y2="1585.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="912" x2="953" y1="1585.6641" y2="1585.6641"/><polygon fill="#A80036" points="922,1581.6641,912,1585.6641,922,1589.6641,918,1585.6641" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="918" y="1537.3325">validates</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="918" y="1552.4653">コンテンツタイプが</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="918" y="1567.5981">enumで設定した値か?</text><path d="M831,1600.6641 L900,1600.6641 L900,1607.6641 L890,1617.6641 L831,1617.6641 L831,1600.6641 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="146.4688" style="stroke: #000000; stroke-width: 2.0;" width="312" x="831" y="1600.6641"/><text fill="#000000" font-family="Menlo" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="24" x="846" y="1613.731">alt</text><text fill="#000000" font-family="Menlo" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="915" y="1612.8745">[タイプがテキスト]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="911" x2="953" y1="1654.0625" y2="1654.0625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="953" x2="953" y1="1654.0625" y2="1667.0625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="912" x2="953" y1="1667.0625" y2="1667.0625"/><polygon fill="#A80036" points="922,1663.0625,912,1667.0625,922,1671.0625,918,1667.0625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="918" y="1633.8638">validates</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="918" y="1648.9966">contentが存在するか？</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="831" x2="1143" y1="1676.0625" y2="1676.0625"/><text fill="#000000" font-family="Menlo" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="836" y="1686.2729">[タイプがイメージ]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="911" x2="953" y1="1726.1328" y2="1726.1328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="953" x2="953" y1="1726.1328" y2="1739.1328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="912" x2="953" y1="1739.1328" y2="1739.1328"/><polygon fill="#A80036" points="922,1735.1328,912,1739.1328,922,1743.1328,918,1739.1328" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="918" y="1705.9341">validates</text><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="918" y="1721.0669">thumbnailがURLで画像拡張子か？</text><path d="M419,1761.1328 L488,1761.1328 L488,1768.1328 L478,1778.1328 L419,1778.1328 L419,1761.1328 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="88.0703" style="stroke: #000000; stroke-width: 2.0;" width="575" x="419" y="1761.1328"/><text fill="#000000" font-family="Menlo" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="24" x="434" y="1774.1997">alt</text><text fill="#000000" font-family="Menlo" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58" x="503" y="1773.3433">[作成成功]</text><polygon fill="#A80036" points="506,1780.2656,496,1784.2656,506,1788.2656,502,1784.2656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="500" x2="900" y1="1784.2656" y2="1784.2656"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="419" x2="994" y1="1793.2656" y2="1793.2656"/><text fill="#000000" font-family="Menlo" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58" x="424" y="1803.4761">[作成失敗]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="911" x2="953" y1="1833.2031" y2="1833.2031"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="953" x2="953" y1="1833.2031" y2="1846.2031"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="906" x2="953" y1="1846.2031" y2="1846.2031"/><polygon fill="#A80036" points="916,1842.2031,906,1846.2031,916,1850.2031,912,1846.2031" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="918" y="1828.1372">rollback</text><path d="M230,1877.2031 L299,1877.2031 L299,1884.2031 L289,1894.2031 L230,1894.2031 L230,1877.2031 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.2031" style="stroke: #000000; stroke-width: 2.0;" width="331" x="230" y="1877.2031"/><text fill="#000000" font-family="Menlo" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="24" x="245" y="1890.27">alt</text><text fill="#000000" font-family="Menlo" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58" x="314" y="1889.4136">[作成成功]</text><polygon fill="#A80036" points="328,1911.4688,318,1915.4688,328,1919.4688,324,1915.4688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="322" x2="484" y1="1915.4688" y2="1915.4688"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="334" y="1910.4028">OKを返す</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="230" x2="561" y1="1924.4688" y2="1924.4688"/><text fill="#000000" font-family="Menlo" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58" x="235" y="1934.6792">[作成失敗]</text><polygon fill="#A80036" points="328,1955.4063,318,1959.4063,328,1963.4063,324,1959.4063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="322" x2="489" y1="1959.4063" y2="1959.4063"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="334" y="1954.3403">エラーメッセージを返す</text><path d="M23,1981.4063 L92,1981.4063 L92,1988.4063 L82,1998.4063 L23,1998.4063 L23,1981.4063 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="135.5" style="stroke: #000000; stroke-width: 2.0;" width="1322" x="23" y="1981.4063"/><text fill="#000000" font-family="Menlo" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="24" x="38" y="1994.4731">alt</text><text fill="#000000" font-family="Menlo" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58" x="107" y="1993.6167">[作成成功]</text><polygon fill="#A80036" points="1179,2015.6719,1189,2019.6719,1179,2023.6719,1183,2019.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="317" x2="1185" y1="2019.6719" y2="2019.6719"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="324" y="2014.606">画面の作成</text><rect fill="#99FF99" filter="url(#fr20d1kb3qdxo)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="140" x="1191" y="1998.5391"/><text fill="#000000" font-family="Menlo" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="126" x="1198" y="2018.5342">メッセージ一覧画面</text><polygon fill="#A80036" points="73,2060.9688,63,2064.9688,73,2068.9688,69,2064.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="67" x2="1262" y1="2064.9688" y2="2064.9688"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="312" x="79" y="2059.9028">メッセージ一覧を表示・作成完了のフラッシュを表示</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1345" y1="2073.9688" y2="2073.9688"/><text fill="#000000" font-family="Menlo" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58" x="28" y="2084.1792">[作成失敗]</text><polygon fill="#A80036" points="73,2104.9063,63,2108.9063,73,2112.9063,69,2108.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="67" x2="311" y1="2108.9063" y2="2108.9063"/><text fill="#000000" font-family="Menlo" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="79" y="2103.8403">エラーメッセージのフラッシュを表示</text><!--MD5=[db32d1ce158660c8815d8f01b7a60c99]
@startuml
skinparam defaultFontName Menlo
skinparam backgroundColor #FFFFFE

title メッセージを作成する

actor 管理者 as admin
participant メッセージ作成画面 as message_new #99FF99
participant AdminMessages as AdminMessages <<Controller>>
participant Message as Message <<Model>>
participant MessageContent as MessageContent <<Model>>
participant User as User <<Model>>
participant メッセージ一覧画面 as message_index #99FF99


== 作成画面を表示 ==

admin -> AdminMessages: メッセージ作成画面を開く\n:new()
activate admin
activate AdminMessages

AdminMessages -> User: 管理者か？
activate User
ref over User: 管理者チェック!
User - -> AdminMessages
deactivate User

create message_new
AdminMessages - -> message_new
deactivate AdminMessages
activate message_new
message_new - -> admin: メッセージ作成画面を表示
deactivate message_new

== メッセージを作成 ==

admin ->> message_new: タイトルを入力する
activate message_new
admin ->> message_new: 配信する日付と時間を入力する

loop メッセージコンテンツの個数
  admin ->> message_new: コンテンツのタイプを選択する
  alt タイプがテキスト
    admin ->> message_new: テキストを入力する
  else タイプがイメージ
    admin ->> message_new: 画像URLを入力する
  end
end

admin -> message_new: メッセージ作成ボタンを押す
message_new -> AdminMessages: フォーム内容をPOSTする\n:create()
activate AdminMessages

AdminMessages -> User: 管理者か？
activate User
ref over User: 管理者チェック!
User - -> AdminMessages
deactivate User

AdminMessages -> AdminMessages: ストロングパラメータを通す

group Transaction
  AdminMessages -> AdminMessages: トランザクション コミット
  AdminMessages -> Message: メッセージを作成\n:new()
  activate Message
  Message -> Message: パラメータの\nタイトル\n配信日\nをセット
  Message -> Message: ステータスを未配信でセット
  Message -> Message: メッセージをセーブ
  Message -> Message: validates\nタイトルが存在するか？\n配信時間がdate型でnow以降か？

  alt 作成成功
    Message - -> AdminMessages: メッセージを返す
  else 作成失敗
    Message -> Message: rollback
    deactivate Message
  end

  loop コンテンツの個数
    AdminMessages -> MessageContent: メッセージコンテンツを作成\n:message.message_contents.new
    activate MessageContent
    MessageContent -> MessageContent: パラメータの\nコンテンツタイプ\nコンテンツ(テキストorサムネイル)\nをセット
    MessageContent -> MessageContent: メッセージコンテンツをセーブ
    MessageContent -> MessageContent: validates\nコンテンツタイプが\nenumで設定した値か?
    alt タイプがテキスト
      MessageContent -> MessageContent: validates\ncontentが存在するか？
    else タイプがイメージ
      MessageContent -> MessageContent: validates\nthumbnailがURLで画像拡張子か？
    end
    alt 作成成功
      MessageContent - -> AdminMessages
    else 作成失敗
      MessageContent -> MessageContent: rollback
      deactivate MessageContent
    end
  end
end

alt 作成成功
  AdminMessages - -> message_new: OKを返す
else 作成失敗
  AdminMessages - -> message_new: エラーメッセージを返す
  deactivate AdminMessages
end

alt 作成成功
  create message_index
  message_new - -> message_index: 画面の作成
  activate message_index
  message_index - -> admin: メッセージ一覧を表示・作成完了のフラッシュを表示
  deactivate message_index
else 作成失敗
  message_new - -> admin: エラーメッセージのフラッシュを表示
  deactivate message_new
end
@enduml

PlantUML version 1.2020.12(Sat Jun 06 19:54:15 JST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: ja
Country: JP
--></g></svg>